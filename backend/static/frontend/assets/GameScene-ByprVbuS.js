import{j as e,D as y,T as w,C,M as k,b as P,S as A,O as E,d as v,V as u,u as T,P as O,e as B,f as D,E as L,G as I}from"./three-nGGz72_1.js";import{r as h,c as S}from"./vendor-CnEhrtKZ.js";import{P as g}from"./index-DpsEWzRx.js";const z=({onSquareClick:o,highlightedSquares:r=[]})=>{const c=h.useRef(null),i=h.useMemo(()=>{const s=[];for(let t=0;t<8;t++)for(let a=0;a<8;a++){const p=(t+a)%2===0?"#f0d9b5":"#b58863";s.push({x:t,y:a,position:[t-3.5,0,a-3.5],color:p})}return s},[]),l=h.useMemo(()=>r.map(({x:s,y:t,color:a="#00ff00"})=>({x:s,y:t,position:[s-3.5,.01,t-3.5],color:a})),[r]),f=(s,t)=>{o&&o(s,t)};return e.jsxs("group",{ref:c,children:[e.jsxs("mesh",{position:[0,-.05,0],receiveShadow:!0,children:[e.jsx("boxGeometry",{args:[8.2,.1,8.2]}),e.jsx("meshStandardMaterial",{color:"#654321"})]}),i.map(({x:s,y:t,position:a,color:m})=>e.jsxs("mesh",{position:a,onClick:()=>f(s,t),receiveShadow:!0,children:[e.jsx("planeGeometry",{args:[.98,.98]}),e.jsx("meshStandardMaterial",{color:m})]},`${s}-${t}`)),l.map(({x:s,y:t,position:a,color:m})=>e.jsxs("mesh",{position:a,children:[e.jsx("ringGeometry",{args:[.3,.45,16]}),e.jsx("meshBasicMaterial",{color:m,transparent:!0,opacity:.6,side:y})]},`highlight-${s}-${t}`)),Array.from({length:8},(s,t)=>e.jsx(w,{position:[t-3.5,.01,-4.2],rotation:[-Math.PI/2,0,0],fontSize:.2,color:"#333",anchorX:"center",anchorY:"middle",children:String.fromCharCode(97+t)},`file-${t}`)),Array.from({length:8},(s,t)=>e.jsx(w,{position:[-4.2,.01,t-3.5],rotation:[-Math.PI/2,0,0],fontSize:.2,color:"#333",anchorX:"center",anchorY:"middle",children:(8-t).toString()},`rank-${t}`))]})},M=()=>new P(.3,.8,8),X=()=>new v(.25,.35,.7,8),Y=()=>new E(.4),$=()=>new A(.35,16,12),V=o=>{switch(o){case g.TALENT:return M();case g.LEADER:return X();case g.STRATEGIST:return Y();case g.INVESTOR:return $();default:return M()}},_=(o,r)=>{const c=new C(o),i=Math.min(.2+r*.2,.8),l=Math.max(.8-r*.15,.2);return new k({color:c,metalness:i,roughness:l,emissive:new C(c).multiplyScalar(.1)})},N=({piece:o,position:r,isSelected:c=!1,isHighlighted:i=!1,onClick:l,animateMove:f=!0})=>{const s=h.useRef(null),[t,a]=h.useState(!1),m=h.useRef(new u(...r)),p=h.useRef(new u(...r));S.useEffect(()=>{m.current.set(...r)},[r]),T(()=>{if(!(!s.current||!f)){if(p.current.lerp(m.current,.1),s.current.position.copy(p.current),c){const x=Date.now()*.002;s.current.position.y=r[1]+Math.sin(x)*.05+.1}if(t){const x=1+Math.sin(Date.now()*.005)*.05;s.current.scale.setScalar(x)}else s.current.scale.lerp(new u(1,1,1),.1)}});const j=x=>{x.stopPropagation(),l&&l(o)},n=x=>{x.stopPropagation(),a(!0),document.body.style.cursor="pointer"},d=()=>{a(!1),document.body.style.cursor="auto"},b=V(o.pieceType),R=_(o.ownerColor,o.level);return e.jsxs("group",{children:[e.jsx("mesh",{ref:s,geometry:b,material:R,position:r,onClick:j,onPointerOver:n,onPointerOut:d,castShadow:!0,receiveShadow:!0}),c&&e.jsxs("mesh",{position:[r[0],.01,r[2]],children:[e.jsx("ringGeometry",{args:[.4,.5,16]}),e.jsx("meshBasicMaterial",{color:"#ffff00",transparent:!0,opacity:.8,side:y})]}),i&&e.jsxs("mesh",{position:[r[0],.02,r[2]],children:[e.jsx("ringGeometry",{args:[.35,.4,16]}),e.jsx("meshBasicMaterial",{color:"#00ff00",transparent:!0,opacity:.6,side:y})]}),e.jsxs(w,{position:[r[0],r[1]+.8,r[2]],fontSize:.15,color:o.ownerColor,anchorX:"center",anchorY:"middle",outlineWidth:.02,outlineColor:"#ffffff",children:["L",o.level]}),o.transformCount>0&&e.jsx("group",{children:Array.from({length:o.transformCount},(x,G)=>e.jsxs("mesh",{position:[r[0]-.3+G*.15,r[1]+.6,r[2]],children:[e.jsx("sphereGeometry",{args:[.03]}),e.jsx("meshBasicMaterial",{color:"#ffd700"})]},G))}),o.pieceType===g.INVESTOR&&e.jsxs("mesh",{position:[r[0],r[1]+1,r[2]],children:[e.jsx("ringGeometry",{args:[.1,.15,8]}),e.jsx("meshBasicMaterial",{color:"#ff6b6b",transparent:!0,opacity:.8,side:y})]}),o.pieceType===g.STRATEGIST&&e.jsxs("mesh",{position:[r[0],r[1]+1,r[2]],children:[e.jsx("ringGeometry",{args:[.1,.15,6]}),e.jsx("meshBasicMaterial",{color:"#4ecdc4",transparent:!0,opacity:.8,side:y})]}),Object.keys(o.temporaryBuffs||{}).length>0&&e.jsxs("mesh",{position:[r[0]+.4,r[1]+.5,r[2]],children:[e.jsx("sphereGeometry",{args:[.05]}),e.jsx("meshBasicMaterial",{color:"#ff9500",transparent:!0,opacity:.9})]})]})},q=({preset:o,target:r=[0,0,0],enableControls:c=!0})=>{const i=h.useRef(null),l=h.useRef(new u),f=h.useRef(new u(...r)),s={"top-down":{position:new u(0,12,.1),lookAt:new u(0,0,0)},isometric:{position:new u(8,8,8),lookAt:new u(0,0,0)},"side-view":{position:new u(0,4,10),lookAt:new u(0,0,0)}};return S.useEffect(()=>{const t=s[o];l.current.copy(t.position),f.current.copy(t.lookAt)},[o]),S.useEffect(()=>{f.current.set(...r)},[r]),T(()=>{i.current&&(i.current.position.lerp(l.current,.05),i.current.lookAt(f.current),i.current.updateProjectionMatrix())}),e.jsx(O,{ref:i,makeDefault:!0,fov:60,near:.1,far:1e3,position:s[o].position.toArray()})},Z=({pieces:o,selectedPiece:r,validMoves:c=[],cameraPreset:i="isometric",showGrid:l=!0,enableShadows:f=!0,onPieceClick:s,onSquareClick:t})=>{const a=(n,d)=>[n-3.5,.5,d-3.5],m=c.map(n=>({x:n.x,y:n.y,color:"#00ff0080"}));r&&m.push({x:r.positionX,y:r.positionY,color:"#ffff0080"});const p=(n,d)=>{t&&t(n,d)},j=n=>{s&&s(n)};return e.jsx(B,{shadows:f,camera:{position:[8,8,8],fov:60},gl:{antialias:!0,alpha:!0,powerPreference:"high-performance"},dpr:[1,2],children:e.jsxs(h.Suspense,{fallback:null,children:[e.jsx(q,{preset:i}),e.jsx(D,{enablePan:!0,enableZoom:!0,enableRotate:!0,minDistance:3,maxDistance:20,maxPolarAngle:Math.PI/2,target:[0,0,0]}),e.jsx("ambientLight",{intensity:.4}),e.jsx("directionalLight",{position:[10,10,10],intensity:1,castShadow:f,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048,"shadow-camera-far":50,"shadow-camera-left":-20,"shadow-camera-right":20,"shadow-camera-top":20,"shadow-camera-bottom":-20}),e.jsx("directionalLight",{position:[-5,5,5],intensity:.3}),e.jsx(L,{preset:"city",background:!1}),l&&e.jsx(I,{position:[0,-.1,0],args:[20,20],cellSize:1,cellThickness:.5,cellColor:"#ffffff",sectionSize:4,sectionThickness:1,sectionColor:"#666666",fadeDistance:30,fadeStrength:1,infiniteGrid:!0}),e.jsx(z,{onSquareClick:p,highlightedSquares:m}),o.map(n=>e.jsx(N,{piece:n,position:a(n.positionX,n.positionY),isSelected:(r==null?void 0:r.id)===n.id,isHighlighted:c.some(d=>d.x===n.positionX&&d.y===n.positionY),onClick:j},n.id)),e.jsx("fog",{attach:"fog",args:["#f0f0f0",15,30]})]})})};export{Z as G};
//# sourceMappingURL=GameScene-ByprVbuS.js.map
